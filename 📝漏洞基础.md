# SQL注入
## 定义
 SQL注入（SQL Injection）是一种常见且危险的安全漏洞，是由于应用程序没有正确地检查用户输入而导致的。攻击者通过在输入参数中注入恶意SQL语句，并将其作为用户输入提交，从而成功地执行对数据库的攻击。这种攻击方式可能导致敏感数据泄露、数据篡改，甚至完全控制数据库。

JDBC提供的PreparedStatement、Statement以及JdbcTemplate等框架都可能会导致SQL注入。MyBatis框架的使用不当或未正确配置，也可能存在SQL注入的风险。 

## 分类
+ **联合查询注入**：通过`UNION SELECT`拼接返回结果。

 将两个结果合并，泄露账号密码：

```sql
id=1 UNION SELECT username,password FROM users
```

+ **报错注入**：利用数据库的报错信息泄露数据（如`extractvalue()`、`updatexml()`）。

利用数据库报错信息直接泄露当前数据库名：

```sql
id=1 AND updatexml(1,concat(0x7e,(SELECT database()),0x7e),1)
```

+ **布尔盲注**：通过页面返回的真/假差异来判断。

 通过真假差异逐步猜数据：

```sql
id=1 AND 1=1 → 页面正常  
id=1 AND 1=2 → 页面异常/无数据
```

+ **时间盲注**：通过数据库延时函数（如`sleep()`）来推断。

 页面延迟 5 秒，说明条件成立：

```sql
id=1 AND IF(ASCII(SUBSTR(user(),1,1))>100, SLEEP(5), 0)
```

+ **堆叠查询**：多语句执行（如`1; DROP TABLE user--`）。

 多条语句一起执行，导致数据被删除：

```sql
id=1; DROP TABLE users;
```

+ **二次注入**：数据在第一次写入时未触发漏洞，在第二次被拼接时被利用。

注册时输入用户名：`admin' --`， 插入数据库时被转义存储；但在修改资料时拼接 SQL，又触发注入。  

## 常见利用方式
+ 绕过登录验证（`' OR '1'='1`）。
+ 获取敏感数据（用户名、密码hash）。
+ 读写数据库文件。

## 防御措施
+ 使用预编译/参数化查询（PreparedStatement）。
+ 严格输入校验与转义。
+ 最小化数据库权限。
+ Web 应用防火墙（WAF）。

# SSRF
## 定义
SSRF（Server-Side Request Forgery）是一种服务器端请求伪造的安全漏洞，攻击者通过构造恶意请求，让目标服务器发起请求到攻击者指定的内部网站或者外部网站，从而达到获取内部网站信息或者攻击外部网站的目的。常见的攻击方式包括利用目标服务器的功能从外部获取数据、攻击内网系统、绕过防火墙和任意文件读取等。 

## 分类
+ **基础SSRF**：直接传入URL，服务端请求。

 服务端访问本地管理接口：

```plain
url=http://127.0.0.1/admin
```

+ **跳转型SSRF**：利用30X跳转绕过。

 利用跳转绕过初步过滤：

```plain
url=http://evil.com/redirect -> 302 -> http://127.0.0.1/admin
```

+ **DNS Rebinding/短链接绕过**：先解析为外网IP，再切换为内网。

 短链第一次解析为外网，之后切换到内网IP：

```plain
url=http://short.url/abc
```

+ **协议扩展型**：利用`file://`、`dict://`、`gopher://`等协议扩大攻击面。

 服务端读取本地敏感文件：

```plain
url=file:///etc/passwd
url=gopher://127.0.0.1:6379/_FLUSHALL
```

## 常见利用方式
+ 访问内网管理接口（如`http://127.0.0.1:8080/admin`）。
+ 探测云环境元数据服务（如 AWS`http://169.254.169.254/`）。
+ 扫描内网端口。
+ 结合gopher协议发起更复杂的攻击（如Redis未授权写入）。

## 防御措施
+ URL 白名单校验。
+ 禁止访问内网地址（`127.0.0.1`, `169.254.*`等）。
+ 限制协议，只允许`http/https`。
+ 统一请求代理，集中做安全控制。

# RCE（Remote Code Execution）  
## 定义
RCE（Remote Code Execution），远程代码执行漏洞，是指攻击者通过远程方式在目标系统上执行恶意代码或命令，从而控制系统或者窃取敏感信息等行为。

## 分类
+ **命令执行类**
    - `Runtime.exec()` / `ProcessBuilder` 拼接输入。
    - WebShell 上传。

```plain
Runtime.getRuntime().exec("ls " + userInput);
输入userInput=; cat /etc/passwd
```

+ **脚本引擎执行**
    - GroovyShell、JavaScript`ScriptEngine.eval()`、Python`eval/exec`。

```plain
ScriptEngine engine = new ScriptEngineManager().getEngineByName("js");
engine.eval(userInput);
输入userInput=print(1+1)
```

+ **反序列化 RCE**
    - 反序列化时执行 gadget 链，触发任意方法调用。

 服务端反序列化攻击者传来的对象：

```plain
ObjectInputStream in = new ObjectInputStream(socket.getInputStream());
Object obj = in.readObject(); // 攻击链触发执行
```

+ **模板注入 RCE**
    - Velocity / Freemarker / Thymeleaf 模板注入。

 模板语法里直接执行系统命令：

```plain
${"freemarker.template.utility.Execute"?new()("id")}
```

## 常见利用方式
+ 获取服务器权限（如执行`whoami`、写入文件）。
+ 建立反弹shell。
+ 横向移动，获取数据库、云服务密钥等。

## 防御措施
+ 避免执行用户输入的命令/代码（禁止`eval`、`exec`、`shell.evaluate`等）。
+ 参数化调用（如`new ProcessBuilder("ls", "-l", userInput)`而不是拼接）。
+ 严格的输入白名单、路径限制。
+ 使用容器/沙箱运行不可信代码，最小化权限。

# XSS
## 定义
XSS（跨站脚本攻击）是一种常见的Web安全漏洞，攻击者通过在受害者的浏览器中执行恶意脚本代码，从而窃取用户数据、篡改网页内容，甚至劫持用户的会话。XSS漏洞的根本原因在于Web应用程序没有正确处理用户输入，使得恶意脚本代码能够被插入并在客户端执行。  

## 分类
1.  反射型XSS（Reflected XSS）  

反射型XSS是指恶意脚本随着用户请求的URL参数或者表单数据即时反射到响应页面中，攻击者通过构造特定的链接诱使用户点击，从而执行恶意脚本。这种攻击方式通常是一次性的，攻击者需要诱导用户点击恶意链接。

2. 存储型XSS（Stored XSS）

存储型XSS是指恶意脚本被永久存储在目标网站的服务器端（如数据库、日志文件等），当其他用户访问该页面时，恶意脚本会被自动执行。这种攻击方式最为危险，因为恶意脚本会持续存在，任何访问该页面的用户都会受到攻击。

3.  DOM型XSS（DOM-based XSS）

DOM型XSS是指攻击者通过修改浏览器中的DOM（文档对象模型），使得客户端JavaScript执行恶意代码，通常不需要与服务器交互。攻击者通过操控客户端脚本来改变页面内容或执行恶意操作，这种攻击不需要服务器端漏洞。

## 常见利用方式
1. 窃取用户凭证：攻击者可以通过XSS注入脚本，盗取用户的session cookie或身份验证信息，并将其发送到攻击者控制的服务器，从而劫持用户的身份。
2. 篡改页面内容：攻击者可以通过注入恶意脚本来修改网页内容，例如更改表单字段，篡改用户的交易数据等，欺骗用户进行错误操作。
3. 钓鱼攻击（Phishing）：XSS攻击可以在页面中插入伪造的表单或弹窗，诱导用户输入敏感信息（如用户名、密码、银行卡号等），这些信息随后被攻击者获取。
4. 执行恶意脚本：攻击者可以通过脚本攻击用户的浏览器，执行恶意操作，比如访问用户的本地文件、获取系统信息、或者在受害者的计算机上执行其他恶意代码。
5. 利用第三方脚本攻击：XSS 攻击可以用于注入第三方的恶意广告脚本、追踪脚本或其他危险内容，增加网站的攻击面。

## 防御措施
1. 输入验证和输出编码：
    - 对所有用户输入进行严格的验证和过滤，防止恶意代码注入。
    - 对输出到浏览器的内容进行适当的HTML转义或编码，防止浏览器执行注入的脚本。
2. 使用CSP（Content Security Policy）：
    - 配置CSP来限制网页加载的外部资源，防止恶意脚本的执行。
3. 使用 Web 框架的安全功能：
    - 现代Web框架（如Spring）通常提供防止XSS的功能，如自动对输出进行HTML转义。应确保使用框架的安全功能。
4. 对 URL 参数进行严格检查：
    - 对用户输入的URL参数进行严格验证，防止恶意脚本通过URL注入。

# XXE
## 定义
XXE（XML外部实体）漏洞是一种Web应用程序中的安全漏洞，它利用XML解析器在处理XML数据时，错误地允许外部实体被加载和执行。攻击者通过在XML中嵌入恶意的外部实体，能够在目标系统上读取本地文件、发起网络请求、泄露敏感信息等，甚至造成远程代码执行。XXE漏洞的根本原因在于XML解析器允许外部实体加载，而没有进行适当的安全配置。

## 分类
1. 基于文件读取的XXE：攻击者通过XML请求读取目标服务器的本地文件，如`/etc/passwd`或其他敏感配置文件，获取机密信息。这是XXE漏洞最常见的攻击方式。
2. 基于远程服务器的XXE：攻击者通过XML请求触发外部服务器的连接，例如向外部服务器发送HTTP请求，从而导致信息泄露或对外部资源发起恶意请求（如SSRF攻击）。
3. 基于DTD（Document Type Definition）的XXE：攻击者通过在XML中插入DTD，构造包含外部实体的恶意请求，从而让XML解析器加载并执行外部实体内容。
4. Blind XXE：这类XXE攻击并不直接返回攻击者的目标数据，但攻击者可以通过观察服务器响应的不同表现（如延迟等）来推测是否成功触发了XXE漏洞。

## 常见利用方式
1. 读取敏感文件
2. 发起SSRF攻击（Server-Side Request Forgery）
3. 远程代码执行（RCE）
4. 数据泄露
5. DoS攻击（Denial of Service）

## 防御措施
1. 禁用外部实体  
2. 使用安全的XML解析器

# DoS
## 定义
DoS（拒绝服务）攻击是一种通过大量消耗目标系统资源（如 CPU、内存、带宽等），导致目标服务无法正常提供服务的攻击方式。DoS攻击的目的是使目标系统无法提供服务，影响系统的可用性。

## 分类
1. 带宽耗尽型DoS（Bandwidth Flooding）：通过大量的网络流量攻击目标，消耗目标系统的带宽，导致目标无法正常响应合法请求。常见的方式是发送大量的请求包（如 SYN Flood、UDP Flood），使得目标无法处理正常的流量。
2. 资源耗尽型DoS（Resource Exhaustion）：攻击者通过消耗目标系统的计算资源（如 CPU、内存、磁盘 I/O 等），使得系统资源过载，导致服务无法响应。常见的方式包括内存耗尽、CPU 饱和、数据库查询过载 等。
3. 应用层DoS（Application Layer DoS）：攻击者通过发送特定的应用层请求来消耗目标服务器的计算资源或存储空间。与传统的网络层DoS攻击不同，应用层攻击通过利用特定的Web应用漏洞或协议漏洞发起攻击。常见的攻击方式包括HTTP Flood、Slowloris等。
4. 分布式拒绝服务攻击（DDoS）：DDoS（分布式拒绝服务）是一种通过多个受控计算机（通常是僵尸网络）同时向目标发起攻击，从而使目标系统资源被消耗殆尽，导致服务不可用。DDoS是DoS攻击的一个扩展，通过多个来源发起攻击，增加了攻击的强度和隐蔽性。

## 常见利用方式
1. ReDos
2. 图片Dos
3. SYN Flood  

## 防御措施
1. 流量过滤：部署 Web 应用防火墙（WAF）、入侵防御系统（IDS）和入侵检测系统（IPS），监控并过滤恶意流量，阻止异常请求达到服务器。
2. 负载均衡：通过使用负载均衡器将流量分散到多个服务器或数据中心，减轻单一服务器的压力，提高服务的可用性。
3. 反向代理和缓存：使用反向代理服务器和缓存来减轻目标服务器的负担，特别是针对静态资源和不频繁变化的内容。

# CSRF
## 定义
CSRF（跨站请求伪造）是一种利用受害者的身份信息来向目标网站发送恶意请求的攻击方式。攻击者通过诱导用户点击恶意链接、访问恶意网站或提交伪造的表单，利用受害者的登录状态和身份验证信息，在目标站点执行未授权的操作。CSRF 攻击的根本原因在于应用没有对敏感操作的请求进行有效的验证，而是依赖于浏览器自动附带的会话信息（如 Cookie、Session）进行身份验证。

## 分类
1. 普通CSRF：攻击者诱使受害者访问恶意网站，并通过恶意链接或表单提交伪造请求。
2. 盗用Cookie的CSRF：攻击者通过恶意脚本或社交工程方式偷取受害者的session cookie，然后在自己的服务器上伪造请求。
3. 延迟CSRF：攻击者不仅要求用户执行恶意操作，还可能通过时间延迟或诱导受害者在不知情的情况下，执行恶意操作。常见的例子是攻击者利用定时任务、延时提交等方式。
4. 基于身份验证的CSRF：利用受害者的登录会话，攻击者可以通过伪造请求提交敏感操作，造成严重影响（如转账、密码修改等）。这种攻击通常发生在用户长期登录状态下，没有采用 CSRF 防护的情况下。

## 常见利用方式
1. 更改用户资料
2. 转账操作
3. 发送伪造请求  

## 防御措施
1.  使用CSRF Token  
2.  Referer或Origin头验证


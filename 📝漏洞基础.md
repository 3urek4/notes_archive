# SQL注入
## 定义
 SQL注入（SQL Injection）是一种常见且危险的安全漏洞，是由于应用程序没有正确地检查用户输入而导致的。攻击者通过在输入参数中注入恶意SQL语句，并将其作为用户输入提交，从而成功地执行对数据库的攻击。这种攻击方式可能导致敏感数据泄露、数据篡改，甚至完全控制数据库。

JDBC提供的PreparedStatement、Statement以及JdbcTemplate等框架都可能会导致SQL注入。MyBatis框架的使用不当或未正确配置，也可能存在SQL注入的风险。 

## 分类
+ **联合查询注入**：通过`UNION SELECT`拼接返回结果。

 将两个结果合并，泄露账号密码：

```sql
id=1 UNION SELECT username,password FROM users
```

+ **报错注入**：利用数据库的报错信息泄露数据（如`extractvalue()`、`updatexml()`）。

利用数据库报错信息直接泄露当前数据库名：

```sql
id=1 AND updatexml(1,concat(0x7e,(SELECT database()),0x7e),1)
```

+ **布尔盲注**：通过页面返回的真/假差异来判断。

 通过真假差异逐步猜数据：

```sql
id=1 AND 1=1 → 页面正常  
id=1 AND 1=2 → 页面异常/无数据
```

+ **时间盲注**：通过数据库延时函数（如`sleep()`）来推断。

 页面延迟 5 秒，说明条件成立：

```sql
id=1 AND IF(ASCII(SUBSTR(user(),1,1))>100, SLEEP(5), 0)
```

+ **堆叠查询**：多语句执行（如`1; DROP TABLE user--`）。

 多条语句一起执行，导致数据被删除：

```sql
id=1; DROP TABLE users;
```

+ **二次注入**：数据在第一次写入时未触发漏洞，在第二次被拼接时被利用。

注册时输入用户名：`admin' --`， 插入数据库时被转义存储；但在修改资料时拼接 SQL，又触发注入。  

## 常见利用方式
+ 绕过登录验证（`' OR '1'='1`）。
+ 获取敏感数据（用户名、密码hash）。
+ 读写数据库文件。

## 防御措施
+ 使用预编译/参数化查询（PreparedStatement）。
+ 严格输入校验与转义。
+ 最小化数据库权限。
+ Web 应用防火墙（WAF）。

# SSRF
## 定义
SSRF（Server-Side Request Forgery）是一种服务器端请求伪造的安全漏洞，攻击者通过构造恶意请求，让目标服务器发起请求到攻击者指定的内部网站或者外部网站，从而达到获取内部网站信息或者攻击外部网站的目的。常见的攻击方式包括利用目标服务器的功能从外部获取数据、攻击内网系统、绕过防火墙和任意文件读取等。 

## 分类
+ **基础SSRF**：直接传入URL，服务端请求。

 服务端访问本地管理接口：

```plain
url=http://127.0.0.1/admin
```

+ **跳转型SSRF**：利用30X跳转绕过。

 利用跳转绕过初步过滤：

```plain
url=http://evil.com/redirect -> 302 -> http://127.0.0.1/admin
```

+ **DNS Rebinding/短链接绕过**：先解析为外网IP，再切换为内网。

 短链第一次解析为外网，之后切换到内网IP：

```plain
url=http://short.url/abc
```

+ **协议扩展型**：利用`file://`、`dict://`、`gopher://`等协议扩大攻击面。

 服务端读取本地敏感文件：

```plain
url=file:///etc/passwd
url=gopher://127.0.0.1:6379/_FLUSHALL
```

## 常见利用方式
+ 访问内网管理接口（如`http://127.0.0.1:8080/admin`）。
+ 探测云环境元数据服务（如 AWS`http://169.254.169.254/`）。
+ 扫描内网端口。
+ 结合gopher协议发起更复杂的攻击（如Redis未授权写入）。

## 防御措施
+ URL 白名单校验。
+ 禁止访问内网地址（`127.0.0.1`, `169.254.*`等）。
+ 限制协议，只允许`http/https`。
+ 统一请求代理，集中做安全控制。

# RCE（Remote Code Execution）  
## 定义
RCE（Remote Code Execution），远程代码执行漏洞，是指攻击者通过远程方式在目标系统上执行恶意代码或命令，从而控制系统或者窃取敏感信息等行为。

## 分类
+ **命令执行类**
    - `Runtime.exec()` / `ProcessBuilder` 拼接输入。
    - WebShell 上传。

```plain
Runtime.getRuntime().exec("ls " + userInput);
输入userInput=; cat /etc/passwd
```

+ **脚本引擎执行**
    - GroovyShell、JavaScript`ScriptEngine.eval()`、Python`eval/exec`。

```plain
ScriptEngine engine = new ScriptEngineManager().getEngineByName("js");
engine.eval(userInput);
输入userInput=print(1+1)
```

+ **反序列化 RCE**
    - 反序列化时执行 gadget 链，触发任意方法调用。

 服务端反序列化攻击者传来的对象：

```plain
ObjectInputStream in = new ObjectInputStream(socket.getInputStream());
Object obj = in.readObject(); // 攻击链触发执行
```

+ **模板注入 RCE**
    - Velocity / Freemarker / Thymeleaf 模板注入。

 模板语法里直接执行系统命令：

```plain
${"freemarker.template.utility.Execute"?new()("id")}
```

## 常见利用方式
+ 获取服务器权限（如执行`whoami`、写入文件）。
+ 建立反弹shell。
+ 横向移动，获取数据库、云服务密钥等。

## 防御措施
+ 避免执行用户输入的命令/代码（禁止`eval`、`exec`、`shell.evaluate`等）。
+ 参数化调用（如`new ProcessBuilder("ls", "-l", userInput)`而不是拼接）。
+ 严格的输入白名单、路径限制。
+ 使用容器/沙箱运行不可信代码，最小化权限。

